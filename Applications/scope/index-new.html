<!-- $Id$
 *
 * Red Pitaya Oscilloscope client
 *
 * Author: Dakus <info@eskala.eu>
 *         
 * (c) Red Pitaya  http://www.redpitaya.com
 *
-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8"></meta>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Red Pitaya</title>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/style.css">
<script src="js/jquery-2.1.3.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.flot.js"></script>
<script type="text/javascript">

  // App configuration
  var config = {
    socket_url: 'ws://192.168.128.1:9002',    // WebSocket server URI
    socket_reconnect_timeout: 1000            // Milliseconds
  };
  
  // App state
  var state = {
    socket_opened: false,
    processing: false,
    editing: false
  };
  
  // Params cache
  var params = { 
    orig: {}, 
    local: {}
  };
  
  // Other global variables
  var ws = null;
  var plot = null;
  
  // Page onload
  $(function() {
  
    // Connect to websocket
    connectWebSocket();
  
    // Websocket events
    if(ws) {
    
      ws.onopen = function() {
        state.socket_opened = true;
        console.log('Socket opened');
      };
      
      ws.onclose = function() {
        state.socket_opened = false;
        console.log('Socket closed. Trying to reopen in ' + config.socket_reconnect_timeout/1000 + ' sec...');
        setTimeout(function() {
          ws = new WebSocket(config.socket_url);
        }, config.socket_reconnect_timeout);
      };
      
      ws.onerror = function(ev) {
        console.log('Websocket error: ', ev);
      };
      
      ws.onmessage = function(ev) {
        if(state.processing) {
          return;
        }
        state.processing = true;
        
        var receive = JSON.parse(ev.data);

        if(receive.parameters) {
          processParameters(receive.parameters);
        }
        
        if(receive.signals) {
          processSignals(receive.signals);
        }
        
        state.processing = false;
      };
    }
    
    $('input').keyup(function(event){
      if(event.keyCode == 13){
        exitEditing();
      }
    });
    
    $('.close-dialog').click(function() {
      exitEditing();
    });  
    
    $('#meas_done').click(function() {              
      if($("input[name='meas_signal']").is(':checked')) {
        var checked_signal = $("input[name='meas_signal']:checked").val();
        var meas_operator = $('#meas_operator').val();
        var meas_name = 'OSC_MEAS_' + checked_signal + '_' + meas_operator;
        
        if($('#' + meas_name).length > 0) {
          return;
        }
        
        $('#clear_means_content').prepend('<div id="' + meas_name + '" class="clear-means">'+ meas_operator +'(' + checked_signal + ')</div>');
        $('.vpp-min').prepend('<div class="' + meas_name + '" class="show-param">' + checked_signal +'(' + meas_operator +') ' + 123 + ' mV </div>');
      }
    });
  
    $('.edit-mode').click(function() {
      state.editing = true;
      $('#right_menu').hide();
      $('#' + $(this).attr('id') + '_dialog').show();  
    });
    
    $('#OSC_RUN').click(function() {
      $('#OSC_RUN').hide();
      $('#OSC_STOP').css('display','block');
      params.local['OSC_RUN'] = { value: true };
      sendParams();
    }); 
    
    $('#OSC_STOP').click(function() {
      $('#OSC_STOP').hide();
      $('#OSC_RUN').show(); 
      params.local['OSC_RUN'] = { value: false };
      sendParams();
    });
    
    $('.menu-btn').click(function() {
      $('#right_menu .menu-btn').not(this).removeClass('active');
    });
    
    $('#edge1').click(function(){
      $('#edge1').find('img').attr('src','img/edge1_active.png');
      $('#edge2').find('img').attr('src','img/edge2.png');
    });
    
    $('#edge2').click(function(){
      $('#edge2').find('img').attr('src','img/edge2_active.png');
      $('#edge1').find('img').attr('src','img/edge1.png');
    });

    $(document).on('click', '.clear-means', function() {
      var get_id = $(this).attr('id');
      $('.' + get_id).remove();
      $(this).remove();
    });
    
    $('#jtk_fine').click(function(){
      var img = $('#jtk_fine');
      img.attr('src', (img.attr('src') == 'img/fine.png' ? 'img/fine_active.png' : 'img/fine.png'));
    });

    $('#jtk_up').mousedown(function(){ $('#jtk_btns').attr('src','img/node_up.png'); });
    $('#jtk_left').mousedown(function(){ $('#jtk_btns').attr('src','img/node_left.png'); });
    $('#jtk_right').mousedown(function(){ $('#jtk_btns').attr('src','img/node_right.png'); });
    $('#jtk_down').mousedown(function(){ $('#jtk_btns').attr('src','img/node_down.png'); });

    $('#jtk_up').mouseup(function(){ $('#jtk_btns').attr('src','img/node_fine.png'); });
    $('#jtk_left').mouseup(function(){ $('#jtk_btns').attr('src','img/node_fine.png'); });
    $('#jtk_right').mouseup(function(){ $('#jtk_btns').attr('src','img/node_fine.png'); });
    $('#jtk_down').mouseup(function(){ $('#jtk_btns').attr('src','img/node_fine.png'); });

    $.preloadImages = function() {
      for(var i = 0; i < arguments.length; i++) {
        $('<img />').attr('src', 'img/' + arguments[i]);
      }
    }
    $.preloadImages('edge1_active.png','edge2_active.png','node_up.png','node_left.png','node_right.png','node_down.png','fine_active.png');
    
    // Bind to the window resize event to redraw the graph; trigger that event to do the first drawing
    $(window).resize(function() {
    
      // Redraw the grid
      drawGraphGrid();
      
      // Resize and redraw the plot
      $('#plot').css($('#graph_grid').css(['height','width']));
    }).resize();

  });
  
  function connectWebSocket() {
    if(window.WebSocket) {
      ws = new WebSocket(config.socket_url);
    } 
    else if(window.MozWebSocket) {
      ws = new MozWebSocket(config.socket_url);
    } 
    else {
      console.log('Browser does not support WebSocket');
    }
  }
  
  function processParameters(new_params) {
    for(var param_name in new_params) {
    
      // Do nothing if new parameter value is the same as the old one
      if(params.orig[param_name] !== undefined && params.orig[param_name].value === new_params[param_name].value) {
        continue;
      }
      
      // Save data for new parameter
      params.orig[param_name] = new_params[param_name];
      
      // Do not change field values when user is editing something
      if(! state.editing) {
        var field = $('#' + param_name);
        
        if(param_name == 'OSC_RUN') {
          if(new_params[param_name].value === true) {
            $('#OSC_RUN').hide();
            $('#OSC_STOP').css('display','block');
          }
          else {
            $('#OSC_STOP').hide();
            $('#OSC_RUN').show();
          }
        }
        else if(field.is('select') || field.is('input:text')) {
          field.val(new_params[param_name].value);
        }
        else if(field.is('button')) {
          field[new_params[param_name].value === true ? 'addClass' : 'removeClass' ]('active');
        }
        else if(field.is('input:radio')) {
          var radios = $('input[name="' + param_name + '"]');
          
          radios.closest('.btn-group').children('.btn.active').removeClass('active');
          
          if(param_name == 'OSC_TRIG_SLOPE') {
            if(new_params[param_name].value == 0) {
              $('#edge1').find('img').attr('src','img/edge1.png');
              $('#edge2').addClass('active').find('img').attr('src','img/edge2_active.png').end().find('#OSC_TRIG_SLOPE1').prop('checked', true);
            }
            else {
              $('#edge1').addClass('active').find('img').attr('src','img/edge1_active.png').end().find('#OSC_TRIG_SLOPE').prop('checked', true);
              $('#edge2').find('img').attr('src','img/edge2.png');
            }
          }
          else {
            radios.eq([new_params[param_name].value]).prop('checked', true).parent().addClass('active');
          }
        }
        else if(field.is('span')) {
          field.html(new_params[param_name].value);
        }
      } 
    }
  }
  
  function processSignals(new_signals) {
    var points = [];
    var start = +new Date();
    
    $('#right_menu button').removeClass('active');
    
    for(sig_name in new_signals) {
      var sig_points = [];
      
      for(var i=0; i<new_signals[sig_name].size; i++) {
        sig_points.push([i, new_signals[sig_name].value[i]]);
      }
      
      points.push(sig_points);
    }
    
    var end_loop = +new Date();
    console.log('Loop: ' + (end_loop - start));
    
    if(plot) {
      plot.setData(points);
      plot.draw();
      console.log('Draw: ' + ((+new Date()) - end_loop));
    }
    else {
      plot = $.plot('#plot', points, {
        series: {
          shadowSize: 0   // Drawing is faster without shadows
        },
        yaxis: {
          min: -7.5,
          max: 7.5
        },
        xaxis: {
          //min: -20
        },
        grid: {
          show: false
        }
      });
      
      console.log('First draw: ' + ((+new Date()) - end_loop));
    }
  }
  
  function exitEditing() {
    var changed_local = false;

    for(var key in params.orig) {
      var field = $('#' + key);
      var value = undefined;

      if(key == 'OSC_RUN'){
        value = (field.is(':visible') ? 0 : 1);
      }
      else if(field.is('select') || field.is('input:text')) {
        value = field.val();
      }
      else if(field.is('button')) {
        value = (field.hasClass('active') ? 1 : 0);
      }
      else if(field.is('input:radio')) {
        value = $('input[name="' + key + '"]:checked').val();
      }
      
      if(value !== undefined && value != params.orig[key].value) {
        console.log(key + ' changed from ' + params.orig[key].value + ' to ' + ($.type(params.orig[key].value) == 'boolean' ? !!value : value));
        params.local[key] = { value: ($.type(params.orig[key].value) == 'boolean' ? !!value : value) };
        changed_local = true;
      }
    }
    
    // Send local params, if there are any changes
    if(changed_local) {
      sendParams();
    }
    
    // Reset editing state and hide dialog
    state.editing = false;
    $('.dialog:visible').hide();
    $('#right_menu').show(); 
  }
  
  function sendParams() {
    if(! state.socket_opened) {
      console.log('ERROR: Cannot save changes, socket not opened');
      return false;
    }
    
    /* TEMP TEST */
    params.local['DEBUG_PARAM_PERIOD'] = { value: 5000 };
    params.local['DEBUG_SIGNAL_PERIOD'] = { value: 1000 };
    params.local['OSC_CH1_SCALE'] = { value: 1 };
    params.local['OSC_CH1_PROBE'] = { value: 1 };
    //params.local['CH1_SHOW'] = { value: true };
    //params.local['CH2_SHOW'] = { value: true };
    /**/
    
    ws.send(JSON.stringify({ parameters: params.local }));
    params.local = {};
    return true;
  }
  
  function drawGraphGrid() {
    var canvas_width = $('#graph_holder').width() - 2;
    var canvas_height = Math.round(canvas_width / 2.3);
    
    var center_x = canvas_width / 2;
    var center_y = canvas_height / 2;
    
    var ctx = $('#graph_grid')[0].getContext('2d');
    
    var x_offset = 0;
    var y_offset = 0;
    
    // Set canvas size
    ctx.canvas.width = canvas_width;
    ctx.canvas.height = canvas_height;
    
    // Set draw options
    ctx.beginPath();
    ctx.lineWidth = 1;
    ctx.strokeStyle = '#5d5d5c';

    // Draw ticks
    for(var i = 1; i < 50; i++) {
      x_offset = x_offset + (canvas_width / 50);
      y_offset = y_offset + (canvas_height / 50);
      
      if(i == 25) {
        continue;
      }
      
      ctx.moveTo(x_offset, canvas_height - 3);
      ctx.lineTo(x_offset, canvas_height);
      
      ctx.moveTo(0, y_offset);
      ctx.lineTo(3, y_offset);
    }

    // Draw lines
    x_offset = 0;
    y_offset = 0;
    
    for(var i = 1; i < 10; i++){
      x_offset = x_offset + (canvas_height / 10);
      y_offset = y_offset + (canvas_width / 10);
      
      if(i == 5) {
        continue;
      }
      
      ctx.moveTo(y_offset, 0);
      ctx.lineTo(y_offset, canvas_height);
      
      ctx.moveTo(0, x_offset);
      ctx.lineTo(canvas_width, x_offset);
    } 
    
    ctx.stroke();
    
    // Draw central cross
    ctx.beginPath();
    ctx.lineWidth = 1;
    ctx.strokeStyle = '#999';
    
    ctx.moveTo(center_x, 0);
    ctx.lineTo(center_x, canvas_height);
    
    ctx.moveTo(0, center_y);
    ctx.lineTo(canvas_width, center_y);
    
    ctx.stroke();
  }
</script>
</head>
<body>
  <div class="full-content">
    <div class="container-fluid"> 
      <div class="navbar navbar-inverse" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"> 
              <span class="sr-only">T</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button> 
            <a class="navbar-brand" href="#">
              <img class="back-btn" src="img/arrow_nav_left.png">
            </a>
            <img class="logo" src="img/logo_nav_white.png">
          </div> 

          <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
              <li><a href="#">HOME</a></li>
              <li><a href="#" data-toggle="modal" data-target="#settings">SETTINGS</a></li>
              <li><a href="#" data-toggle="modal" data-target="#export">EXPORT</a></li>
              <li><a href="#">SINGLE</a></li>
              <li><a href="#">AUTO</a></li>
              <li>
                <a id="OSC_RUN" href="#">RUN</a>
                <a id="OSC_STOP" href="#" style="display:none">STOP</a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Modal export-->
      <div class="modal" id="export" tabindex="-1" role="dialog" aria-labelledby="export" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
              <h4 class="modal-title">Export</h4>
            </div>
            <div class="modal-body">
              Content
            </div>
          </div>
        </div>
      </div>
      
      <!-- Modal settings-->
      <div class="modal" id="settings" tabindex="-1" role="dialog" aria-labelledby="export" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
              <h4 class="modal-title">Settings</h4>
            </div>
            <div class="modal-body">
              Content settings
            </div>
          </div>
        </div>
      </div>
      
      <div class="menu-content">
        <div id="right_menu" class="row right-menu-cont">
          
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button type="button" class="btn menu-btn ch1" data-toggle="button" aria-pressed="false" autocomplete="off">IN1</button>
            </div>
          </div>
          <div class="col-xs-6 option-content"><div id="in1" class="right-menu-option edit-mode"><img src="img/gear.png"></div></div>
          
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button type="button" class="btn menu-btn ch2" data-toggle="button" aria-pressed="false" autocomplete="off">IN2</button>
            </div>
          </div>
          <div class="col-xs-6 option-content"><div id="in2" class="right-menu-option edit-mode"><img src="img/gear.png"></div></div>
          
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button type="button" class="btn menu-btn out1" data-toggle="button" aria-pressed="false" autocomplete="off">OUT1</button>
            </div>
          </div>              
          <div class="col-xs-6 option-content"><div id="out1" class="right-menu-option edit-mode"><img src="img/gear.png"></div></div>
          
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button type="button" class="btn menu-btn out2" data-toggle="button" aria-pressed="false" autocomplete="off">OUT2</button>
            </div>
          </div>              
          <div class="col-xs-6 option-content"><div id="out2" class="right-menu-option edit-mode"><img src="img/gear.png"></div></div>
          
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button type="button" class="btn menu-btn math1" data-toggle="button" aria-pressed="false" autocomplete="off">MATH</button>
            </div>
          </div>              
          <div class="col-xs-6 option-content"><div id="math" class="right-menu-option edit-mode"><img src="img/gear.png"></div></div>
          
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button type="button" class="btn menu-btn trig" data-toggle="button" aria-pressed="false" autocomplete="off">TRIG</button>
            </div>
          </div>                            
          <div class="col-xs-6 option-content"><div id="trig" class="right-menu-option edit-mode"><img src="img/gear.png"></div></div>
          
          <div class="col-xs-6 option-content">
            <div id="cursor" class="right-menu-option edit-mode">CURSOR</div>
          </div>
          
          <div class="col-xs-6 option-content">
            <div id="meas" class="right-menu-option edit-mode">MEAS</div>
          </div>
        </div>

        <div id="in1_dialog" class="dialog row right-menu-cont">
          <div class="col-xs-12 option-content">
            <div class="in1 right-menu-option close-dialog">
              <img src="img/arrow_nav_left.png">
              Input 1
            </div>
          </div>
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button id="CH1_SHOW" type="button" class="btn active" data-toggle="button" aria-pressed="false" autocomplete="off">SHOW</button>
            </div>
          </div>
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button type="button" class="btn" data-toggle="button" aria-pressed="false" autocomplete="off">INVERT</button>
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <span class="col-info">Input gain</span>
            <div class="right-menu-option">
              <select id="OSC_CH1_PROBE" class="form-control styled-select">
                <option>1</option>
                <option selected>10</option>
                <option>100</option>
              </select>
            </div>
          </div>
          <div class="col-xs-12 option-content out2">
            <span class="col-info">Measurement range</span>
            <div class="right-menu-option">0</div>
          </div>
          <div class="col-xs-12 option-content">
            <span class="col-info">Vertical offset</span>
            <div class="right-menu-option">
              <input id="OSC_CH1_OFFSET" class="setfiled" name="OSC_CH1_OFFSET" type="text" value="0">
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <div class="btn-group btn-group-justified" data-toggle="buttons">
                <label class="btn active">
                  <input type="radio" value="0" name="OSC_CH1_IN_GAIN" id="OSC_CH1_IN_GAIN" autocomplete="off" checked>LV
                </label>
                <label class="btn">
                  <input type="radio" value="1" name="OSC_CH1_IN_GAIN" id="OSC_CH1_IN_GAIN1" autocomplete="off">HV
                </label>
              </div>  
            </div>
          </div>
        </div>
        
        <div id="in2_dialog" class="dialog row right-menu-cont">
          <div class="col-xs-12 option-content">
            <div class="in2 right-menu-option close-dialog">
              <img src="img/arrow_nav_left.png">
              Input 2
            </div>
          </div>
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button id="CH2_SHOW" type="button" class="btn active" data-toggle="button" aria-pressed="false" autocomplete="off">SHOW</button>
            </div>
          </div>
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button type="button" class="btn" data-toggle="button" aria-pressed="false" autocomplete="off">INVERT</button>
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <span class="col-info">Input gain</span>
              <select id="OSC_CH2_PROBE" class="form-control styled-select">
                <option>1</option>
                <option selected>10</option>
                <option>100</option>
              </select>
            </div>
          </div>
          <div class="col-xs-12 option-content out2">
            <span class="col-info">Measurement range</span>
            <div class="right-menu-option">0</div>
          </div>
          <div class="col-xs-12 option-content">
            <span class="col-info">Vertical offset</span>
            <div class="right-menu-option">
              <input id="OSC_CH2_OFFSET" class="setfiled" name="OSC_CH2_OFFSET" type="text" value="0">
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <div class="btn-group btn-group-justified" data-toggle="buttons">
                <label class="btn active">
                  <input type="radio" value="0" id="OSC_CH2_IN_GAIN" name="OSC_CH2_IN_GAIN" autocomplete="off" checked>LV
                </label>
                <label class="btn">
                  <input type="radio" value="1" id="OSC_CH2_IN_GAIN1" name="OSC_CH2_IN_GAIN" autocomplete="off">HV
                </label>
              </div>
            </div>
          </div>
        </div>
        
        <div id="out1_dialog" class="dialog row right-menu-cont">
          <div class="col-xs-6 option-content">
            <div class="right-menu-option out1 close-dialog">
              <img src="img/arrow_nav_left.png">
              Output1
            </div>
          </div>
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button id="OUTPUT1_STATE" type="button" class="btn" data-toggle="button" aria-pressed="false" autocomplete="off">ON</button>
            </div>
          </div>
          
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button id="OUTPUT1_SHOW" type="button" class="btn" data-toggle="button" aria-pressed="false" autocomplete="off">SHOW</button>
            </div>
          </div>
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <span class="col-info">Type</span>
              <select class="form-control styled-select">
                <option>SINE</option>
                <option>TRIANGLE</option>
                <option>SQUARE</option>
                <option>FROM FILE*</option>
              </select>
            </div>
          </div>
          
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <div class="btn-group btn-group-justified" data-toggle="buttons">
                <label class="btn">
                  <span class="col-info-activ">Mode</span>
                  <input type="radio" value="0" name="SOUR1_BURS_STAT" id="SOUR1_BURS_STAT" autocomplete="off">CONT
                </label>
                <label class="btn">
                  <input type="radio" value="1" name="SOUR1_BURS_STAT" id="SOUR1_BURS_STAT1" autocomplete="off">SINGLE
                </label>
              </div>
            </div>
          </div>
          
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <span class="col-info">Trigger</span>
              <select id="SOUR1_TRIG_SOUR" class="form-control styled-select">
                <option value="0">External Positive edge</option>
                <option value="1">External Negative edge</option>
                <option value="2">Internal</option>
                <option value="3">Gated</option>
              </select>
            </div>
          </div>

          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <span class="col-info">Frequency</span>
              <input class="setfiled" name="SOUR1_FREQ_FIX" id="SOUR1_FREQ_FIX" type="text" value="0">
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <span class="col-info">Aplitude</span>
              <input class="setfiled" name="SOUR1_VOLT" id="SOUR1_VOLT" type="text" value="0">
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <span class="col-info">Offset</span>
              <input class="setfiled" name="SOUR1_VOLT_OFFS" id="SOUR1_VOLT_OFFS" type="text" value="0">
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <span class="col-info">Duty cycle</span>
              <input class="setfiled" name="SOUR1_DCYC" id="SOUR1_DCYC" type="text" value="0">
            </div>
          </div>
        </div>
        
        <div id="out2_dialog" class="dialog row right-menu-cont">
          <div class="col-xs-6 option-content">
            <div class="right-menu-option out2 close-dialog">
              <img src="img/arrow_nav_left.png">
              Output2
            </div>
          </div>
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button id="OUTPUT2_STATE" type="button" class="btn" data-toggle="button" aria-pressed="false" autocomplete="off">ON</button>
            </div>
          </div>
          
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button id="OUTPUT2_SHOW" type="button" class="btn" data-toggle="button" aria-pressed="false" autocomplete="off">SHOW</button>
            </div>
          </div>
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <span class="col-info">Type</span>
              <select class="form-control styled-select">
                <option>SINE</option>
                <option>TRIANGLE</option>
                <option>SQUARE</option>
                <option>FROM FILE*</option>
              </select>
            </div>
          </div>
       
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <div class="btn-group btn-group-justified" data-toggle="buttons">
                <label class="btn">
                  <span class="col-info-activ">Mode</span>
                  <input type="radio" value="0" name="SOUR2_BURS_STAT" id="SOUR2_BURS_STAT" autocomplete="off">CONT
                </label>
                <label class="btn">
                  <input type="radio" value="1" name="SOUR2_BURS_STAT" id="SOUR2_BURS_STAT1" autocomplete="off">SINGLE
                </label>
              </div>
            </div>
          </div>
          
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <span class="col-info">Trigger</span>
              <select id="SOUR2_TRIG_SOUR" class="form-control styled-select">
                <option value="0">External Positive edge</option>
                <option value="1">External Negative edge</option>
                <option value="2">Internal</option>
                <option value="3">Gated</option>
              </select>
            </div>
          </div>
          
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <span class="col-info">Frequency</span>
              <input class="setfiled" name="SOUR2_FREQ_FIX" id="SOUR2_FREQ_FIX" type="text" value="0">
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <span class="col-info">Aplitude</span>
              <input class="setfiled" name="SOUR2_VOLT" id="SOUR2_VOLT" type="text" value="0">
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <span class="col-info">Offset</span>
              <input class="setfiled" name="SOUR2_VOLT_OFFS" type="text" value="0">
            </div>
          </div>
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <span class="col-info">Phase</span>
              <input class="setfiled" name="SOUR2_PHAS" id="SOUR2_PHAS" type="text" value="0">
            </div>
          </div>
          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <span class="col-info">Duty cycle</span>
              <input class="setfiled" name="SOUR2_DCYC" id="SOUR2_DCYC" type="text" value="0">
            </div>
          </div>
        </div>
        
        <div id="math_dialog" class="dialog row right-menu-cont">
          <div class="col-xs-12 option-content close-dialog">
            <div class="right-menu-option math1">
              <img src="img/arrow_nav_left.png">
              MATH
            </div>
          </div> 
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <div class="btn-group btn-group-justified" data-toggle="buttons">
                <label class="btn">
                  <span class="col-info-activ">Signal1</span>
                  <input type="radio" value="0" name="signal_1" id="signal_1_1" autocomplete="off">IN1
                </label>
                <label class="btn">
                  <input type="radio" value="1" name="signal_1" id="signal_1_2" autocomplete="off">IN2
                </label>
              </div>
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <span class="col-info">Operator</span>
              <select class="form-control styled-select">
                <option></option>
                <option>+</option>
                <option>-</option>
                <option>*</option>
                <option>dy/dt</option>
                <option>xdy</option>
              </select>
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <div class="btn-group btn-group-justified" data-toggle="buttons">
                <label class="btn">
                  <span class="col-info-activ">Signal2</span>
                  <input type="radio" value="0" name="signal_2" id="signal_2_1" autocomplete="off">IN1
                </label>
                <label class="btn">
                  <input type="radio" value="1" name="signal_2" id="signal_2_2" autocomplete="off">IN2
                </label>
              </div>
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <span class="col-info">Vertical offset</span>
              <input class="setfiled" name="vertical_offset" id="vertical_offset" type="text" value="0">
            </div>
          </div>
        </div>
        
        <div id="trig_dialog" class="dialog row right-menu-cont">
          <div class="col-xs-12 option-content close-dialog">
            <div class="right-menu-option trig">
              <img src="img/arrow_nav_left.png">
              TRIGGER
            </div>
          </div>              
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <div class="btn-group btn-group-justified" data-toggle="buttons">
                <label class="btn active">
                  <span class="col-info-activ">Source</span>
                  <input type="radio" value="0" name="OSC_TRIG_SOURCE" id="OSC_TRIG_SOURCE" autocomplete="off" checked>CH1
                </label>
                <label class="btn">
                  <input type="radio" value="1" name="OSC_TRIG_SOURCE" id="OSC_TRIG_SOURCE2" autocomplete="off">CH2
                </label>
                <label class="btn">
                  <input type="radio" value="2" name="OSC_TRIG_SOURCE" id="OSC_TRIG_SOURCE3" autocomplete="off">EXT
                </label>
              </div>
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <div class="btn-group btn-group-justified" data-toggle="buttons">
                <label id="edge1" class="btn active">
                  <span class="col-info-activ">Edge</span>
                  <input type="radio" value="1" name="OSC_TRIG_SLOPE" id="OSC_TRIG_SLOPE" autocomplete="off" checked>
                  <img src="img/edge1_active.png">
                </label>
                <label id="edge2" class="btn">
                  <input type="radio" value="0" name="OSC_TRIG_SLOPE" id="OSC_TRIG_SLOPE1" autocomplete="off">
                  <img src="img/edge2.png">
                </label>
              </div>
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <span class="col-info">Level</span>
              <input id="OSC_TRIG_LEVEL" class="setfiled" name="OSC_TRIG_LEVEL" type="text" value="0">
            </div>
          </div>
          
          <div class="col-xs-12 option-content">
            <span class="col-info">Mode</span>
            <div class="btn-group btn-group-vertical" data-toggle="buttons">
              <label class="btn active" style="box-shadow: 0px 0px 0px;">
                <input type="radio" value="0" name="OSC_TRIG_SWEEP" id="OSC_TRIG_SWEEP" autocomplete="off" checked>AUTO
              </label>
              <label class="btn" style="box-shadow: 0px 0px 0px;">
                <input type="radio" value="1" name="OSC_TRIG_SWEEP" id="OSC_TRIG_SWEEP1" autocomplete="off">NORMAL
              </label>
              <label class="btn" style="border-radius: 0px;box-shadow: 0px 0px 0px;">
                <input type="radio" value="2" name="OSC_TRIG_SWEEP" id="OSC_TRIG_SWEEP2" autocomplete="off">SINGLE
              </label>
            </div>
          </div>
        </div>
        
        <div id="meas_dialog" class="dialog row right-menu-cont">
          <div class="col-xs-12 option-content close-dialog">
            <div class="right-menu-option">
              <img src="img/arrow_nav_left.png">
              Measurement
            </div>
          </div> 
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <span class="col-info">Operator</span>
              <select id="meas_operator" class="form-control styled-select">
                <option value="VPP">VPP</option>
                <option value="VMEAN">VMEAN</option>
                <option value="VMAX">VMAX</option>
                <option value="VMIN">VMIN</option>
                <option value="DUTY_CYCLE">DUTY CYCLE</option>
                <option value="PERIOD">PERIOD</option>
                <option value="FREQ">FREQ</option>
                <option value="RMS">RMS</option>
              </select>
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <div class="btn-group btn-group-justified" data-toggle="buttons">
                <label class="btn">
                  <span class="col-info-activ">Signal</span>
                  <input type="radio" name="meas_signal" value="CH1" autocomplete="off">IN1
                </label>
                <label class="btn">
                  <input type="radio" name="meas_signal" value="CH2" autocomplete="off">IN2
                </label>
                <label class="btn">
                  <input type="radio" name="meas_signal" value="MATH" autocomplete="off">MATH
                </label>
              </div>
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <button id="meas_done" type="button" class="btn">DONE</button>
          </div>
          <div class="col-xs-12 option-content">
            <span class="col-info">List (click to clear meas.)</span>
            <div id="clear_means_content">
            </div>
          </div>
        </div>
        
        <div id="cursor_dialog" class="dialog row right-menu-cont">
          <div class="col-xs-6 option-content close-dialog">
            <div class="right-menu-option">
              <img src="img/arrow_nav_left.png">
              Cursor
            </div>
          </div>

          <div class="col-xs-6 option-content">
            <div class="right-menu-option">
              <button type="button" class="btn" data-toggle="button" aria-pressed="false" autocomplete="off">ON</button>
            </div>
          </div>
           
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <div class="btn-group btn-group-justified" data-toggle="buttons">
                <label class="btn">
                  <input type="checkbox" name="OSC_CURSOR1_X" id="OSC_CURSOR1_X" autocomplete="off">X1
                </label>
                <label class="btn">
                  <input type="checkbox" name="OSC_CURSOR2_X" id="OSC_CURSOR2_X" autocomplete="off">X2
                </label>
              </div>
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <div class="btn-group btn-group-justified" data-toggle="buttons">
                <label class="btn">
                  <input type="checkbox" name="OSC_CURSOR1_Y" id="OSC_CURSOR1_Y" autocomplete="off">Y1
                </label>
                <label class="btn">
                  <input type="checkbox" name="OSC_CURSOR1_Y" id="OSC_CURSOR1_Y" autocomplete="off">Y2
                </label>
              </div>
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div style="margin: 3px; height: 20px; line-height: 20px;">
              Y signal relation
            </div>
          </div>
          <div class="col-xs-12 option-content">
            <div class="right-menu-option">
              <div class="btn-group btn-group-justified" data-toggle="buttons">
                <label class="btn">
                  <input type="checkbox" name="in1_2" id="in1_2" autocomplete="off"><span class="in1">IN1</span>
                </label>
                <label class="btn">
                  <input type="checkbox" name="in2_2" id="in2_2" autocomplete="off"> <span class="in2">IN2</span>
                </label>
              </div>
            </div>
          </div>
          <div class="col-xs-12 option-content" style="height:100px;"></div>
        </div>
      </div>
  
      <div id="main">
        <div id="buffer">
          <div class="red-horizont-line">
            <div class="red-line"></div>
          </div>
          <div class="fixator"></div>
          <div class="horizontline"></div>
        </div>
        <div id="graph_holder">
          <canvas id="graph_grid"></canvas>
          <div id="plot"></div>
        </div>
        <div class="info">
          <div class="div-out-math">
            <div class="div-title">
              <span class="in1">IN1</span><br />
              <span class="in2">IN2</span><br /> 
              <span class="out1">OUT1</span><br />
              <span class="out2">OUT2</span><br />
              <span class="math1">MATH</span>
            </div>
            <div class="div-value">
              <span id="in1_div" class="in1"><span id="OSC_CH1_SCALE">- </span>V/div</span><br />
              <span id="in2_div" class="in2"><span id="OSC_CH2_SCALE">- </span>V/div</span><br />
              <span id="SOUR1_VOLT" class="out1">- V/div</span><br />
              <span id="SOUR2_VOLT" class="out2">- V/div</span><br />
              <span id="SMATH_VOLT" class="math1">- V^2/div</span>
            </div>
          </div>
          <div class="vpp-min">
          </div>
          <div class="pull-right">
            Time <span id="OSC_TIME_OFFSET">0</span> ms/div <br />
            Trig <img style="margin: -2px 0px 0px 0px;" src="img/toparrow.png"> IN1 <span id="trig_mv">- mV</span><br />
            <img src="img/tarrow.png"> <span id="OSC_TIME_SCALE">1</span><span id="osc_time_scale_units">μs</span><br />
            <span id="mss">- MS/s</span>
          </div>
        </div>
      </div>
      
      <div id="joystick">
        <img id="jtk_fine" src="img/fine.png" />
        <img id="jtk_btns" src="img/node_fine.png" usemap="#jtk_btns_map" />
        <map name="jtk_btns_map">
          <area id="jtk_left" shape="poly" coords="19,28,37,45,32,56,28,69,29,84,36,101,30,112,18,122,11,114,8,104,4,91,1,77,3,59,9,41,19,27" />
          <area id="jtk_up" shape="poly" coords="27,17,42,7,61,3,78,3,89,4,102,7,116,13,124,20,105,37,87,29,64,29,56,33,46,37" target="_self" />
          <area id="jtk_right" shape="poly" coords="111,44,132,27,143,42,147,56,149,76,148,93,141,107,132,123,112,104,119,94,122,76,119,58" />
          <area id="jtk_down" shape="poly" coords="46,112,27,130,38,141,51,145,72,148,92,148,106,142,126,132,104,111,90,118,79,120,71,121,62,119,57,117" />
        </map>
      </div>
    </div>
  </div>
</body>
</html>